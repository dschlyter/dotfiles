#!/usr/bin/env python3
import os
import sys
from datetime import date


def main():
    args = sys.argv[1:]
    if args:
        for file in args:
            if not os.path.exists(file):
                raise Exception(f"{file} does not exist")

            suffix = f"-bak-{date.today()}"
            if bak(file, suffix):
                return

            cnt = 2
            while cnt < 1000 and not bak(file, f"{suffix}-{cnt}"):
                cnt += 1

    else:
        print("Usage: bak file [more files]")


def bak(file, suffix):
    parts = file.split(".")
    i = len(parts) - 2 if len(parts) >= 2 else 0
    parts[i] += suffix

    bak_file = ".".join(parts)
    if not os.path.exists(bak_file):
        os.rename(file, bak_file)
        return True

    return False


if __name__ == '__main__':
    main()
